{% extends "base.html" %}
{% block title %}Shopping Cart • EcoFinds{% endblock %}

{% block content %}
<style>
  .cart-container{max-width:1100px;margin:2rem auto;padding:0 1rem}
  .cart-header{text-align:center;margin-bottom:3rem;animation:fadeInDown .6s ease}
  .cart-icon-main{font-size:3.2rem;background:linear-gradient(135deg,#4CAF50 0,#66BB6A 100%);-webkit-background-clip:text;-webkit-text-fill-color:transparent;margin-bottom:.75rem;animation:pulse 2s infinite}
  .cart-title{color:#1a3d16;font-size:2.25rem;font-weight:700;margin:.25rem 0}
  .cart-subtitle{color:#6b7280;font-size:1rem}
  .cart-items{animation:fadeInUp .6s ease}
  .cart-item{display:flex;align-items:center;padding:1.25rem;background:#fff;border-radius:18px;box-shadow:0 4px 6px rgba(0,0,0,.07);margin-bottom:1.25rem;transition:.25s;border:2px solid transparent;position:relative;overflow:hidden}
  .cart-item:hover{transform:translateY(-3px);box-shadow:0 12px 22px rgba(0,0,0,.12);border-color:rgba(76,175,80,.18)}
  .product-image-wrapper{width:140px;height:140px;flex-shrink:0;border-radius:14px;overflow:hidden;background:linear-gradient(135deg,#f3f4f6 0,#e5e7eb 100%);display:flex;align-items:center;justify-content:center;margin-right:1.5rem;box-shadow:0 4px 8px rgba(0,0,0,.08)}
  .product-image-wrapper img{width:100%;height:100%;object-fit:cover;transition:transform .25s}
  .cart-item:hover .product-image-wrapper img{transform:scale(1.06)}
  .product-image-placeholder{color:#9ca3af;font-size:2.25rem}
  .product-info{flex:1;padding-right:1rem}
  .product-title{margin:0 0 .35rem;color:#1a3d16;font-size:1.25rem;font-weight:650}
  .product-category{display:inline-block;padding:.2rem .65rem;background:rgba(76,175,80,.1);color:#2f9e44;border-radius:999px;font-size:.8rem;font-weight:600;margin-bottom:.6rem}
  .product-description{color:#6b7280;font-size:.95rem;line-height:1.55;margin:.2rem 0 .7rem}
  .product-price{font-weight:750;font-size:1.45rem;background:linear-gradient(135deg,#4CAF50 0,#66BB6A 100%);-webkit-background-clip:text;-webkit-text-fill-color:transparent}
  .cart-actions{display:flex;flex-direction:column;gap:.55rem;margin-left:1rem}
  .btn{padding:.55rem 1.05rem;border-radius:12px;font-size:.9rem;font-weight:600;text-decoration:none;display:inline-flex;align-items:center;justify-content:center;gap:.45rem;transition:.22s;border:none;cursor:pointer;white-space:nowrap}
  .btn-outline{background:#fff;color:#2a7f62;border:2px solid #2a7f62}
  .btn-outline:hover{background:#2a7f62;color:#fff;transform:translateY(-2px);box-shadow:0 4px 12px rgba(42,127,98,.3)}
  .btn-primary{background:linear-gradient(135deg,#4CAF50 0,#66BB6A 100%);color:#fff}
  .btn-primary:hover{filter:brightness(.95);transform:translateY(-2px);box-shadow:0 6px 18px rgba(76,175,80,.35)}
  .btn-danger{background:#ef4444;color:#fff}
  .btn-danger:hover{background:#dc2626;transform:translateY(-2px);box-shadow:0 4px 12px rgba(239,68,68,.28)}
  .btn-secondary{background:#6b7280;color:#fff;padding:.7rem 1.6rem;font-size:.95rem}
  .btn-secondary:hover{background:#4b5563;transform:translateY(-2px)}
  .cart-summary{background:linear-gradient(135deg,#fff 0,#f9fafb 100%);padding:1.6rem;border-radius:18px;box-shadow:0 10px 26px rgba(0,0,0,.1);margin-top:1.5rem;border:2px solid rgba(76,175,80,.1);animation:fadeInUp .8s ease}
  .summary-title{text-align:center;margin-bottom:1rem;color:#1a3d16;font-size:1.35rem;font-weight:700;display:flex;align-items:center;justify-content:center;gap:.5rem}
  .summary-row{display:flex;justify-content:space-between;align-items:center;padding:.7rem 0;border-bottom:1px solid rgba(0,0,0,.05)}
  .summary-row:last-of-type{border-bottom:none;padding-top:1rem;margin-top:.5rem;border-top:2px solid rgba(76,175,80,.2)}
  .summary-label{color:#6b7280;font-size:1rem}
  .summary-value{font-weight:700;color:#374151;font-size:1.05rem}
  .summary-total{font-size:1.6rem}
  .summary-total strong{background:linear-gradient(135deg,#4CAF50 0,#66BB6A 100%);-webkit-background-clip:text;-webkit-text-fill-color:transparent}
  .summary-info{text-align:center;color:#6b7280;font-size:.9rem;margin-top:1rem;padding:.8rem;background:rgba(76,175,80,.06);border-radius:12px}
  .empty-cart{text-align:center;padding:3rem 1.25rem;background:#fff;border-radius:18px;box-shadow:0 10px 26px rgba(0,0,0,.08);animation:fadeInUp .6s ease}
  .empty-cart-icon{font-size:4.2rem;color:#d1d5db;margin-bottom:1rem;opacity:.6}
  .eco-message{background:linear-gradient(135deg,rgba(76,175,80,.05) 0,rgba(102,187,106,.05) 100%);padding:1.6rem;border-radius:18px;text-align:center;margin-top:1.5rem;border:2px solid rgba(76,175,80,.1);animation:fadeInUp 1s ease}
  .eco-icon{font-size:2.2rem;color:#4CAF50;margin-bottom:.5rem}
  .eco-title{color:#1a3d16;margin-bottom:.35rem;font-size:1.25rem;font-weight:700}
  .eco-text{color:#6b7280;font-size:1rem;line-height:1.6}
  .continue-shopping{text-align:center;margin-top:1.25rem}
  @keyframes pulse{0%,100%{transform:scale(1)}50%{transform:scale(1.05)}}
  @keyframes fadeInDown{from{opacity:0;transform:translateY(-18px)}to{opacity:1;transform:translateY(0)}}
  @keyframes fadeInUp{from{opacity:0;transform:translateY(18px)}to{opacity:1;transform:translateY(0)}}
  @media (max-width:768px){
    .cart-item{flex-direction:column;text-align:center;padding:1.1rem}
    .product-image-wrapper{margin-right:0;margin-bottom:1rem;width:128px;height:128px}
    .product-info{padding-right:0;margin-bottom:.75rem}
    .cart-actions{flex-direction:row;justify-content:center;margin-left:0;width:100%;gap:.5rem}
    .btn{flex:1}
    .cart-title{font-size:2rem}
    .summary-total{font-size:1.35rem}
  }
</style>

<div class="cart-container">
  <div class="cart-header">
    <i class="fas fa-shopping-cart cart-icon-main"></i>
    <h1 class="cart-title">Your Shopping Cart</h1>
    <p class="cart-subtitle">Review your sustainable selections</p>
  </div>

  {% if cart_items %}
    <div class="cart-items">
      {% for item in cart_items %}
        <div class="cart-item">
          <!-- Product Image -->
          <div class="product-image-wrapper">
            {# Normalize path and support full URLs #}
            {% set raw = item.product.image if item.product.image else '' %}
            {% set img = raw.lstrip('/') %}
            {% if raw and (raw.startswith('http://') or raw.startswith('https://')) %}
              <img src="{{ raw }}" alt="{{ item.product.title }}">
            {% elif img %}
              <img src="{{ url_for('static', filename=img) }}" alt="{{ item.product.title }}">
            {% else %}
              <i class="fas fa-image product-image-placeholder"></i>
            {% endif %}
          </div>

          <!-- Product Info -->
          <div class="product-info">
            <h3 class="product-title">{{ item.product.title }}</h3>
            {% if item.product.category %}
              <span class="product-category">{{ item.product.category }}</span>
            {% endif %}
            <p class="product-description">
              {% if item.product.description %}
                {{ item.product.description[:100] }}{% if item.product.description|length > 100 %}…{% endif %}
              {% else %}
                No description available
              {% endif %}
            </p>
            <div class="product-price">${{ "%.2f"|format(item.product.price or 0) }}</div>
          </div>

          <!-- Actions -->
          <div class="cart-actions">
            <a href="{{ url_for('product_detail', product_id=item.product.id) }}" class="btn btn-outline">
              <i class="fas fa-eye"></i> View
            </a>
            <a href="{{ url_for('purchase', user_id=user_id, product_id=item.product.id) }}"
               class="btn btn-primary"
               onclick="return confirm('Purchase this item?')">
              <i class="fas fa-shopping-bag"></i> Buy
            </a>
            <a href="{{ url_for('remove_from_cart', item_id=item.id) }}"
               class="btn btn-danger"
               onclick="return confirm('Remove from cart?')">
              <i class="fas fa-trash"></i> Remove
            </a>
          </div>
        </div>
      {% endfor %}
    </div>

    <!-- Summary -->
    {% set subtotal = total_price or 0 %}
    {% set eco_savings = subtotal * 0.10 %}
    {% set final_total = subtotal - eco_savings %}
    <div class="cart-summary">
      <h3 class="summary-title"><i class="fas fa-calculator"></i> Order Summary</h3>
      <div class="summary-row">
        <span class="summary-label">Total Items:</span>
        <span class="summary-value">{{ cart_items|length }}</span>
      </div>
      <div class="summary-row">
        <span class="summary-label">Subtotal:</span>
        <span class="summary-value">${{ "%.2f"|format(subtotal) }}</span>
      </div>
      <div class="summary-row">
        <span class="summary-label">Eco Savings:</span>
        <span class="summary-value" style="color:#2f9e44;">-${{ "%.2f"|format(eco_savings) }}</span>
      </div>
      <div class="summary-row">
        <span class="summary-label" style="font-size:1.1rem;">Total:</span>
        <span class="summary-value summary-total"><strong>${{ "%.2f"|format(final_total) }}</strong></span>
      </div>
      <div class="summary-info">
        <i class="fas fa-info-circle"></i>
        Items are purchased individually. Click “Buy” on each item to complete purchase.
      </div>
    </div>

  {% else %}
    <div class="empty-cart">
      <i class="fas fa-shopping-cart empty-cart-icon"></i>
      <h3>Your cart is empty</h3>
      <p>Discover amazing second-hand treasures and add them to your cart!</p>
      <a href="{{ url_for('home') }}" class="btn btn-primary">
        <i class="fas fa-store"></i> Start Shopping
      </a>
    </div>
  {% endif %}

  <div class="continue-shopping">
    <a href="{{ url_for('home') }}" class="btn btn-secondary">
      <i class="fas fa-arrow-left"></i> Continue Shopping
    </a>
  </div>

  <div class="eco-message">
    <i class="fas fa-recycle eco-icon"></i>
    <h3 class="eco-title">🌍 Making a Difference Together</h3>
    <p class="eco-text">
      Every second-hand purchase saves resources and reduces waste. You're not just shopping —
      you're contributing to a more sustainable future!
    </p>
  </div>
</div>
{% endblock %}
